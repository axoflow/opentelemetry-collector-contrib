# Windows ETW Receiver
<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [development]: logs   |
| Unsupported Platforms | darwin, linux |
| Distributions | [contrib] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Areceiver%2Fetw%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Areceiver%2Fetw) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Areceiver%2Fetw%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Areceiver%2Fetw) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    | [@overorion](https://www.github.com/overorion) |

[development]: https://github.com/open-telemetry/opentelemetry-collector#development
[contrib]: https://github.com/open-telemetry/opentelemetry-collector-releases/tree/main/distributions/otelcol-contrib
<!-- end autogenerated section -->

## Configuration
| Field      | Default   | Description                                |
|------------|---------- |--------------------------------------------|
| `provider` | required  | Provider to be subscribed to               |
| `level`    | optional  | Log level of trace events to be included   |


## Example configuration

```yaml
receivers:
  etw/guid_or_name:
    # provider: "{9e814aad-3204-11d2-9a82-006008a86939}"
    provider: "Microsoft-Windows-Kernel-File"
  etw/with_filtering:
    provider: "Microsoft-Windows-DNSServer"
    level: error
```

### Level filtering

To filter for specific log levels for a given provider specify the `level` field (as done in `etw/with_filtering`).
Higher verbosity values imply that you will get lower levels as well. For example, if you specify `warning` as the value, you will receive all `warning`, `error`, and `critical` events.

The following levels are available:

- `critical`
- `error`
- `warning`
- `information`
- `verbose`


[See the official documentation for details](https://learn.microsoft.com/en-us/windows/win32/wes/eventmanifestschema-leveltype-complextype)

## Troubleshooting

Component can not start, fails with "Insufficient system resources exist to complete the requested service."

In case of non-graceful shutdowns there could be orphaned trace sessions that have to be manually stopped.
Based on the types of the configured providers it's possible that even **one orphaned** session blocks the start up sequence of the ETW receiver.
[See the official documentation for details](https://learn.microsoft.com/en-us/windows/win32/etw/about-event-tracing#types-of-providers)

Use the following command to list currently active tracing sessions:

```powershell
logman.exe query -ets
```

The name of the orphaned session follows this pattern: `ETWReceiverSession-etw/<name_of_the_receiver>`
Run the following command to stop and remove the session:

```powershell
logman.exe stop -ets ETWReceiverSession-etw/<name_of_the_receiver>
logman.exe delete -ets ETWReceiverSession-etw/<name_of_the_receiver>
```

